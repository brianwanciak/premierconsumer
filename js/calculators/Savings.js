KJE.SavingsCalc=function(){this.SAVING_FREQUENCY=KJE.Default.PAY_MONTHLY;this.YEARS_TO_SAVE=0;this.SHOW_TAXES=false;this.NBR_PERIODS=12;this.FRACTION_YEARS_TO_TARGET=0;this.DS_CURRENT=null;this.DS_NEW=null;this.cats=null;this.MSG_CHANGE_TAX=KJE.parameters.get("MSG_CHANGE_TAX","<p>To reach target savings in YEARS_TO_SAVE years:<ul><li>Change monthly contributions to <strong>RQD_SAVE_MONTH</strong>.</li><li>Receive an annual rate of return of return of <strong>RQR_ROR_BFTAX</strong> if no taxes are paid on earnings.</li><li>Receive an annual rate of return of <strong>RQR_ROR_AFTAX</strong> if taxes are paid on earnings.</li></li></ul>");this.MSG_CHANGE_NOTAX=KJE.parameters.get("MSG_CHANGE_NOTAX","<p>To reach target savings in YEARS_TO_SAVE years:<ul><li>Change monthly contributions to <strong>RQD_SAVE_MONTH</strong>.</li><li>Receive an annual rate of return of <strong>RQR_ROR_BFTAX</strong></ul>");this.MSG_EXCEED=KJE.parameters.get("MSG_EXCEED","Savings goal may be reached early.");this.MSG_FAIL=KJE.parameters.get("MSG_FAIL","You need to make a few changes in your plan.");this.MSG_MADE=KJE.parameters.get("MSG_MADE","Savings goal is right on track.");this.sSchedule=new KJE.Repeating()};KJE.SavingsCalc.prototype.clear=function(){this.AMT_TARGET=0;this.YEARS_TO_TARGET=0;this.AMT_CURRENT=0;this.AMT_SAVE_MONTH=0;this.ROR_INVEST=0;this.FED_TAX_RATE=0;this.STATE_TAX_RATE=0;this.INFLATION_RATE=0};KJE.SavingsCalc.prototype.calculate=function(v){var g=KJE;var k=this.AMT_TARGET;var u=this.YEARS_TO_TARGET;var w=this.AMT_CURRENT;var l=this.AMT_SAVE_MONTH;var r=this.ROR_INVEST;var o=this.FED_TAX_RATE;var c=this.STATE_TAX_RATE;var e=this.INFLATION_RATE;var n="";var d=false;var m="";var p=this.YEARS_TO_SAVE*this.NBR_PERIODS;var t=this.ROR_MONTHLY_PERC=KJE.ROR_PERIOD(r/100,this.NBR_PERIODS);var f=KJE.SavingsCalc.solveForMonths(k,w,t,p,l);var a=KJE.SavingsCalc.solveForCurrentAmt(k,w,t,p,l);var b=KJE.SavingsCalc.solveForSaveAmt(k,w,t,p,l);var x=KJE.FV_AMT(KJE.SavingsCalc.solveForROR(k,w,t,p,l),this.NBR_PERIODS,1)-1;var j=x+x*((o+c)/100);this.ENDING_AMOUNT=KJE.FV_AMT(t,p,w)+KJE.FV_BEGIN(t,p,l);j=KJE.FV_AMT(j/this.NBR_PERIODS,this.NBR_PERIODS,1)-1;this.FRACTION_YEARS_TO_TARGET=f/this.NBR_PERIODS;u=Math.floor(f/this.NBR_PERIODS);var q=k/Math.pow((1+e/100),this.YEARS_TO_SAVE);if(f<p){n=this.MSG_EXCEED;d=true;m=""}else{if(f==p){n=this.MSG_MADE;d=true;m=""}else{n=this.MSG_FAIL;d=false;if(this.SHOW_TAXES&&x!=j){m=this.MSG_CHANGE_TAX}else{m=this.MSG_CHANGE_NOTAX}}}f=f-u*12;this.DS_CURRENT=KJE.FloatArray(this.YEARS_TO_SAVE+1);this.DS_NEW=KJE.FloatArray(this.YEARS_TO_SAVE+1);this.sCats=new Array(this.YEARS_TO_SAVE+1);if(v){var h=this.sSchedule;h.clearRepeat();h.addHeader(h.sReportCol("Year",1),h.sReportCol("Contribute",2)+" "+g.dollars(l)+" "+h.sReportCol(this.SAVING_FREQUENCY+"",3),h.sReportCol("Contribute",2)+" "+g.dollars(b,2)+" "+h.sReportCol(this.SAVING_FREQUENCY+"",3));h.addRepeat("&nbsp;",g.dollars(w)+" "+h.sReportCol("Starting Balance",4)+" ",g.dollars(w)+" "+h.sReportCol("Starting Balance",4)+" ")}for(var s=0;s<=this.YEARS_TO_SAVE;s++){this.DS_CURRENT[s]=(this.solveAmtAtYear(s,l));this.DS_NEW[s]=(this.solveAmtAtYear(s,b));this.sCats[s]=""+s;if(v&&s>0){h.addRepeat(s,g.dollars(this.solveAmtAtYear(s,l)),g.dollars(this.solveAmtAtYear(s,b)))}}this.YEARS_TO_TARGET=u;this.MONTHS_BF_TARGET=p;this.MONTHS_TO_TARGET=f;this.RQD_CURRENT=a;this.RQD_SAVE_MONTH=b;this.RQR_ROR_BFTAX=x;this.RQR_ROR_AFTAX=j;this.NPV_TARGET=q;this.YOU_MADE_IT=n;this.MADE_IT=d;this.CHANGE_MSG=m;this.SAVING_FREQUENCY_LOWER=this.SAVING_FREQUENCY.toLowerCase()};KJE.SavingsCalc.prototype.formatReport=function(b){var c=KJE;var a=this.iDecimal;var d=b;d=KJE.replace("CHANGE_MSG",this.CHANGE_MSG,d);d=KJE.replace("AMT_CURRENT",c.dollars(this.AMT_CURRENT),d);d=KJE.replace("AMT_SAVE_MONTH",c.dollars(this.AMT_SAVE_MONTH),d);d=KJE.replace("ROR_INVEST",c.percent(this.ROR_INVEST/100,2),d);d=KJE.replace("FED_TAX_RATE",c.percent(this.FED_TAX_RATE/100),d);d=KJE.replace("STATE_TAX_RATE",c.percent(this.STATE_TAX_RATE/100),d);d=KJE.replace("MARGINAL_TAX_RATE",c.percent((this.STATE_TAX_RATE+this.FED_TAX_RATE)/100),d);d=KJE.replace("INFLATION_RATE",c.percent(this.INFLATION_RATE/100,2),d);d=KJE.replace("YEARS_TO_SAVE",c.number(this.YEARS_TO_SAVE),d);d=KJE.replace("ROR_MONTHLY_PERC",c.percent(this.ROR_MONTHLY_PERC,2),d);d=KJE.replace("RQD_CURRENT",c.dollars(this.RQD_CURRENT),d);d=KJE.replace("RQD_SAVE_MONTH",c.dollars(this.RQD_SAVE_MONTH,2),d);d=KJE.replace("RQR_ROR_BFTAX",c.percent(this.RQR_ROR_BFTAX,2),d);d=KJE.replace("RQR_ROR_AFTAX",c.percent(this.RQR_ROR_AFTAX,2),d);d=KJE.replace("FRACTION_YEARS_TO_TARGET",c.number(this.FRACTION_YEARS_TO_TARGET,1),d);d=KJE.replace("YEARS_TO_TARGET",c.number(this.YEARS_TO_TARGET),d);d=KJE.replace("MONTHS_TO_TARGET",c.number(this.MONTHS_TO_TARGET),d);d=KJE.replace("NPV_TARGET",c.dollars(this.NPV_TARGET),d);d=KJE.replace("YOU_MADE_IT",this.YOU_MADE_IT,d);d=KJE.replace("AMT_TARGET",c.dollars(this.AMT_TARGET),d);d=KJE.replace("NBR_PERIODS",c.number(this.NBR_PERIODS),d);d=KJE.replace("100",c.number(100),d);d=KJE.replace("SAVING_FREQUENCY_LOWER",this.SAVING_FREQUENCY_LOWER,d);d=KJE.replace("SAVING_FREQUENCY",this.SAVING_FREQUENCY,d);d=KJE.replace("ENDING_AMOUNT",c.dollars(this.ENDING_AMOUNT),d);d=d.replace("**REPEATING GROUP**",this.sSchedule.getRepeat());this.sSchedule.clearRepeat();return d};KJE.SavingsCalc.prototype.solveAmtAtYear=function(a,b){return KJE.FV_AMT(this.ROR_MONTHLY_PERC,a*this.NBR_PERIODS,this.AMT_CURRENT)+KJE.FV_BEGIN(this.ROR_MONTHLY_PERC,a*this.NBR_PERIODS,b)};KJE.SavingsCalc.solveForMonths=function(a,b,g,d,e){d=1000/2;var f=1000/4;for(var c=0;c<30;c++){if(this.ifTargetGreater(a,b,g,d,e)){d+=f}else{d-=f}f=f/2}return d};KJE.SavingsCalc.solveForCurrentAmt=function(a,b,g,d,e){b=10000000/2;var f=10000000/4;for(var c=0;c<30;c++){if(KJE.SavingsCalc.ifTargetGreater(a,b,g,d,e)){b+=f}else{b-=f}f=f/2}return b};KJE.SavingsCalc.solveForSaveAmt=function(a,b,g,d,e){e=100000/2;var f=100000/4;for(var c=0;c<30;c++){if(KJE.SavingsCalc.ifTargetGreater(a,b,g,d,e)){e+=f}else{e-=f}f=f/2}return e};KJE.SavingsCalc.solveForROR=function(a,b,g,d,e){g=0.3/2;var f=g/2;for(var c=0;c<50;c++){if(KJE.SavingsCalc.ifTargetGreater(a,b,g,d,e)){g+=f}else{g-=f}f=f/2}return g};KJE.SavingsCalc.ifTargetGreater=function(a,b,e,c,d){return(a>KJE.FV_AMT(e,c,b)+KJE.FV_BEGIN(e,c,d))};KJE.SavingsCalc.ifTargetSmaller=function(a,b,e,c,d){return(a<KJE.FV_AMT(e,c,b)+KJE.FV_BEGIN(e,c,d))};KJE.Default.PAY_WEEKLY=52;KJE.Default.PAY_BIWEEKLY=26;KJE.Default.PAY_2XMONTHLY=24;KJE.Default.PAY_MONTHLY=12;KJE.Default.PAY_SELECTIONS=KJE.parameters.get("ARRAY_PAY_SELECTIONS",["Weekly","Biweekly","Semi-monthly","Monthly"]);KJE.Default.PAY_DESC=KJE.parameters.get("ARRAY_PAY_DESC",["Weeks","Bi-weekly Payments","Semi-monthly payments","Months"]);KJE.Default.PAY_INDEX=[KJE.Default.PAY_WEEKLY,KJE.Default.PAY_BIWEEKLY,KJE.Default.PAY_2XMONTHLY,KJE.Default.PAY_MONTHLY];KJE.getDropBoxPaymentFreq=function(a,c,b){return KJE.replace("**"+a+"**",KJE.getDropBox(a,KJE.parameters.get(a,c),KJE.Default.PAY_INDEX,KJE.Default.PAY_SELECTIONS),b)};KJE.CalcName="Savings Goals";KJE.CalcType="savingscalculator";KJE.CalculatorTitleTemplate="You could reach your goal in KJE1 years, KJE2 months.";KJE.parseInputs=function(a){return KJE.getDropBoxPaymentFreq("SAVING_FREQUENCY",KJE.Default.PAY_MONTHLY,a)};KJE.initialize=function(){KJE.CalcControl=new KJE.SavingsCalc();KJE.GuiControl=new KJE.Savings(KJE.CalcControl)};KJE.Savings=function(f){var e=KJE;var c=KJE.gLegend;var b=KJE.inputs.items;this.SHOW_INFLATION_CALC=KJE.parameters.get("SHOW_INFLATION_CALC",false);this.MSG_GRAPH1=KJE.parameters.get("MSG_GRAPH1","Saving");this.MSG_GRAPH2=KJE.parameters.get("MSG_GRAPH2","per month");this.MSG_GRAPH_EXCEED=KJE.parameters.get("MSG_GRAPH_EXCEED","Saving MSG_AMOUNT per month will exceed your goal.");this.MSG_GRAPH_MEET=KJE.parameters.get("MSG_GRAPH_MEET","Saving MSG_AMOUNT per month will meet your goal.");this.MSG_GRAPH_SHORT=KJE.parameters.get("MSG_GRAPH_SHORT","Saving MSG_AMOUNT per month will not meet your goal.");this.SHOW_TAXES=KJE.parameters.get("SHOW_TAXES",false);this.SHOW_FREQUENCY=KJE.parameters.get("SHOW_FREQUENCY",false);this.MSG_GRAPH_POP=KJE.parameters.get("MSG_GRAPH_POP","Saving KJE1 KJE2 after year");KJE.DollarSlider("AMT_TARGET","Savings goal",100,10000000,0,0,2);KJE.NumberSlider("YEARS_TO_SAVE","Years to save",1,100,0);KJE.DollarSlider("AMT_CURRENT","Amount currently saved",0,10000000,0,0,2);KJE.DollarSlider("AMT_SAVE_MONTH","Monthly savings",1,10000000,0,0,1);KJE.InvestRateSlider("ROR_INVEST","Expected Rate of return");KJE.PercentSlider("FED_TAX_RATE","Federal tax rate",0,100,1);KJE.PercentSlider("STATE_TAX_RATE","State tax rate",0,100,1);KJE.InflationRateSlider("INFLATION_RATE","Expected inflation rate");KJE.DropBox("SAVING_FREQUENCY","Saving frequency");if(!f.SHOW_TAXES){b.FED_TAX_RATE.hide();b.STATE_TAX_RATE.hide()}if(!this.SHOW_FREQUENCY){b.SAVING_FREQUENCY.hide()}var a=KJE.gNewGraph(KJE.gCOLUMN,"GRAPH1",true,false,KJE.colorList[1],this.SHOW_INFLATION_CALC?KJE.parameters.get("MSG_TITLE_INFLATION_CALC","Adjusted for KJE3 inflation, KJE4 would be worth KJE2 after KJE1 years."):KJE.parameters.get("MSG_GRAPH3","Savings Plan by Year"));a._titleXAxis.setText("");a._titleYAxis.setText(KJE.sCurrency);a._legend._iOrientation=(c.BOTTOM);var d=KJE.parameters.get("MSG_DROPPER_TITLE","Savings plan inputs:");KJE.addDropper(new KJE.Dropper("INPUTS",true,d,d),KJE.colorList[0])};KJE.Savings.prototype.setValues=function(b){var a=KJE.inputs.items;b.SAVING_FREQUENCY=a.SAVING_FREQUENCY.getFormatted();b.NBR_PERIODS=a.SAVING_FREQUENCY.getValue();b.AMT_TARGET=a.AMT_TARGET.getValue();b.YEARS_TO_SAVE=a.YEARS_TO_SAVE.getValue();b.AMT_CURRENT=a.AMT_CURRENT.getValue();b.AMT_SAVE_MONTH=a.AMT_SAVE_MONTH.getValue();b.ROR_INVEST=a.ROR_INVEST.getValue();b.FED_TAX_RATE=a.FED_TAX_RATE.getValue();b.STATE_TAX_RATE=a.STATE_TAX_RATE.getValue();b.INFLATION_RATE=a.INFLATION_RATE.getValue()};KJE.Savings.prototype.refresh=function(f){var e=KJE;var c=KJE.gLegend;var b=KJE.inputs.items;var a=KJE.gGraphs[0];a.removeAll();a.setGraphCategories(f.sCats);a._showItemLabel=(f.DS_CURRENT.length<=2);a._showItemLabelOnTop=true;var d=KJE.getKJEReplaced(this.MSG_GRAPH_POP,e.dollars(f.AMT_SAVE_MONTH),f.SAVING_FREQUENCY_LOWER);var g=Math.round(f.AMT_SAVE_MONTH)-Math.round(f.RQD_SAVE_MONTH);if(g<0){a.add(new KJE.gGraphDataSeries(f.DS_CURRENT,KJE.replace("MSG_AMOUNT",e.dollars(f.AMT_SAVE_MONTH),this.MSG_GRAPH_SHORT),a.getColor(1),null,d))}else{if(g>0){a.add(new KJE.gGraphDataSeries(f.DS_CURRENT,KJE.replace("MSG_AMOUNT",e.dollars(f.AMT_SAVE_MONTH),this.MSG_GRAPH_EXCEED),a.getColor(1),null,d))}}a.add(new KJE.gGraphDataSeries(f.DS_NEW,KJE.replace("MSG_AMOUNT",e.dollars(f.RQD_SAVE_MONTH),this.MSG_GRAPH_MEET),a.getColor(2),null,KJE.getKJEReplaced(this.MSG_GRAPH_POP,e.dollars(f.RQD_SAVE_MONTH),f.SAVING_FREQUENCY)));if(this.SHOW_INFLATION_CALC){a.setTitleTemplate(e.number(f.YEARS_TO_SAVE),e.dollars(f.NPV_TARGET),e.percent(f.INFLATION_RATE/100,2),e.dollars(f.AMT_TARGET))}a.paint();KJE.setTitleTemplate(e.number(f.YEARS_TO_TARGET),e.number(f.MONTHS_TO_TARGET))};KJE.InputScreenText=" <div id=KJE-D-INPUTS><div id=KJE-P-INPUTS>Input information:</div></div> <div id=KJE-E-INPUTS > <div id='KJE-C-AMT_TARGET'><input id='KJE-AMT_TARGET' /></div> <div id='KJE-C-YEARS_TO_SAVE'><input id='KJE-YEARS_TO_SAVE' /></div> <div id='KJE-C-AMT_CURRENT'><input id='KJE-AMT_CURRENT' /></div> <div id='KJE-C-AMT_SAVE_MONTH'><input id='KJE-AMT_SAVE_MONTH' /></div> <div id='KJE-C-SAVING_FREQUENCY'>**SAVING_FREQUENCY**</div> <div id='KJE-C-ROR_INVEST'><input id='KJE-ROR_INVEST' /></div> <div id='KJE-C-INFLATION_RATE'><input id='KJE-INFLATION_RATE' /></div> <div id='KJE-C-FED_TAX_RATE'><input id='KJE-FED_TAX_RATE' /></div> <div id='KJE-C-STATE_TAX_RATE'><input id='KJE-STATE_TAX_RATE' /></div> <div style=\"height:10px\"></div> </div> **GRAPH1** ";KJE.DefinitionText=" <div id='KJE-D-AMT_TARGET'><dt>Savings goal</dt><dd>The amount you wish to have in savings at the end of this savings plan.</dd></div> <div id='KJE-D-YEARS_TO_SAVE'><dt>Years to save</dt><dd>The number of years you have to save.</dd></div> <div id='KJE-D-AMT_CURRENT'><dt>Amount currently saved</dt><dd>Total you currently have saved toward this savings goal.</dd></div> <div id='KJE-D-AMT_SAVE_MONTH'><dt>Monthly savings</dt><dd>The amount you will contribute each month to your investments. This calculator also assumes that you make your contribution at the beginning of each month.</dd></div> <div id='KJE-D-ROR_INVEST'><dt>Expected rate of return</dt><dd>This is the annually compounded rate of return you expect from your savings (after taxes).<p>**ROR_DEFINITION**</dd></div> <div id='KJE-D-INFLATION_RATE'><dt>Expected annual inflation rate</dt><dd>**INFLATION_DEFINITION**</dd></div> ";KJE.ReportText=' <h2 class=\'KJEReportHeader KJEFontHeading\'>YOU_MADE_IT</h2>With your current SAVING_FREQUENCY_LOWER savings of AMT_SAVE_MONTH, you may be able to reach savings goal of AMT_TARGET in FRACTION_YEARS_TO_TARGET years. Saving RQD_SAVE_MONTH SAVING_FREQUENCY_LOWER may total AMT_TARGET in YEARS_TO_SAVE years. However, in YEARS_TO_SAVE years, AMT_TARGET in today\'s dollars would be worth NPV_TARGET when adjusted for INFLATION_RATE inflation. **GRAPH** CHANGE_MSG <div class=KJEReportTableDiv><table class=KJEReportTable><caption class=\'KJEHeaderRow KJEHeading\'><strong>Result Summary</strong></caption> <tr class=KJEOddRow><td class="KJELabel KJECellBorder">Savings goal</td><td class="KJECell">AMT_TARGET</td></tr> <tr class=KJEEvenRow><td class="KJELabel KJECellBorder">Years to save</td><td class="KJECell">YEARS_TO_SAVE</td></tr> <tr class=KJEOddRow><td class="KJELabel KJECellBorder">Amount currently saved</td><td class="KJECell">AMT_CURRENT</td></tr> <tr class=KJEEvenRow><td class="KJELabel KJECellBorder">Current savings</td><td class="KJECell">AMT_SAVE_MONTH SAVING_FREQUENCY</td></tr> <tr class=KJEOddRow><td class="KJELabel KJECellBorder">Expected rate of return</td><td class="KJECell">ROR_INVEST</td></tr> <tr class=KJEEvenRow><td class="KJELabel KJECellBorder">Inflation rate </td><td class="KJECell">INFLATION_RATE</td></tr> <tr class=KJEFooterRow><td class="KJELabel KJECellBorder">Total after YEARS_TO_SAVE years</td><td class="KJELabel">ENDING_AMOUNT</td></tr> <tr class=KJEFooterRow><td class="KJELabel KJECellBorder">Savings required to meet goal in YEARS_TO_SAVE years</td><td class="KJELabel">RQD_SAVE_MONTH SAVING_FREQUENCY_LOWER</td></tr> </table> </div> <h2 class=\'KJEScheduleHeader KJEFontHeading\'>Savings Results by Year</h2> **REPEATING GROUP** ';