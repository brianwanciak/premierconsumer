KJE.TitleTemplate="Your mortgage balance is KJE1 after KJE2.";KJE.parameters.set("PERIODS_HIDE",true);KJE.parameters.set("DEPOSIT_FREQUENCY_HIDE",true);KJE.parameters.set("COMPOUND_INTEREST_HIDE",true);KJE.parameters.set("SIMPLE",true);KJE.parameters.set("MSG_YEARS","Years");KJE.parameters.set("MSG_ADDITIONAL_CONTRIBUTIONS","Monthly loan advance");KJE.parameters.set("MSG_RATE_OF_RETURN","Interest rate");KJE.parameters.set("MSG_REPORT_COL2","Advances");KJE.parameters.set("MSG_STARTING_AMOUNT","Lump sum advance");KJE.parameters.set("MSG_DROPPER_TITLE","Reverse mortgage inputs:");KJE.parameters.set("MSG_DROPPER_CLOSETITLE","KJE1 with an advance of KJE2 KJE3 at KJE4");KJE.CompoundSavingsCalc=function(){this.COMPOUND_PER_PERIOD=KJE.parameters.get("COMPOUND_PER_PERIOD",false);this.bSHOW_BY_PERIOD=false;this.bYEARS_TO_PROJECT=KJE.parameters.get("bYEARS_TO_PROJECT",false);this.SHOW_BY_PERIOD_COUNT=3;this.PERIODS=0;this.COMPOUND_DESC="";this.FREQ_DESC="";this.PAYMENTS_AT_START=KJE.parameters.get("PAYMENTS_AT_START",true);this.MSG_PERIOD_YEARS="";this.sPeriodSelected2="";this.MSG_ERROR2=KJE.parameters.get("MSG_ERROR2","Savings period must be greater than zero");this.ARK_252=false;this.sFmtYears="";this.DS_INTEREST=null;this.DR_INTEREST=null;this.DR_BALANCE=null;this.cats=null;this.sSchedule=new KJE.Repeating()};KJE.CompoundSavingsCalc.prototype.clear=function(){this.STARTING_AMOUNT=0;this.ADDITIONAL_CONTRIBUTIONS=0;this.YEARS=0;this.YEARS_TO_PROJECT=0;this.RATE_OF_RETURN=0;this.COMPOUND_INTEREST_INDEX=KJE.CompoundSavingsCalc.COMPOUND_ANNUAL;this.DEPOSIT_FREQUENCY_INDEX=KJE.CompoundSavingsCalc.DEPOSIT_ANNUAL};KJE.CompoundSavingsCalc.prototype.calculate=function(z){var h=KJE;var c=this.STARTING_AMOUNT;var s=this.ADDITIONAL_CONTRIBUTIONS;var e=this.DEPOSIT_FREQUENCY=KJE.CompoundSavingsCalc.DEPOSIT_VALUE[this.DEPOSIT_FREQUENCY_INDEX];this.FREQ_DESC=KJE.CompoundSavingsCalc.DEPOSIT_SELECTIONS[this.DEPOSIT_FREQUENCY_INDEX];var g=this.YEARS;var o=this.YEARS_TO_PROJECT;var f=this.RATE_OF_RETURN;var b=this.COMPOUND_INTEREST=KJE.CompoundSavingsCalc.COMPOUND_VALUE[this.COMPOUND_INTEREST_INDEX];this.COMPOUND_DESC=KJE.CompoundSavingsCalc.COMPOUND_SELECTIONS[this.COMPOUND_INTEREST_INDEX];if(this.PERIODS==0&&g==0){throw (this.MSG_ERROR2)}this.sPeriodSelected2=KJE.CompoundSavingsCalc.DEPOSIT_SELECTIONS[this.DEPOSIT_FREQUENCY_INDEX];if(e!=1){this.sPeriodSelected=" / "+this.sPeriodSelected2}else{this.sPeriodSelected=""}g=g+Math.floor(this.PERIODS/e);this.PERIODS=(this.PERIODS%e);if(o<g||!this.bYEARS_TO_PROJECT){o=g}if(this.PERIODS>0){this.MSG_PERIOD_YEARS=h.number(((g*e)+this.PERIODS)/e,1)}else{this.MSG_PERIOD_YEARS=h.number(g)}if(this.PERIODS+g*e<=this.SHOW_BY_PERIOD_COUNT*e&&e!=1){this.bSHOW_BY_PERIOD=true}this.sFmtYears="";if(g>0){this.sFmtYears=h.number(o)+" "+(o==1?KJE.MSG_YEAR_LBL:KJE.MSG_YEARS_LBL)}if(this.PERIODS>0){this.sFmtYears+=(this.sFmtYears.length>0?" "+KJE.MSG_AND_LBL+" ":"")+h.number(this.PERIODS)+" "+this.sPeriodSelected2}if(this.ARK_252){b=1;e=252;this.COMPOUND_DESC=""}var p=c+(s*((e*g)+this.PERIODS));var m=Math.round(o);if(this.PERIODS!=0){m++}this.DR_INTEREST=KJE.FloatArray(m);this.DR_BALANCE=KJE.FloatArray(m);this.DR_ADDITIONS=KJE.FloatArray(m);var v=0;var r=0;var d=0;var w=0;var x=0;var l=0;if(b==e){if(this.COMPOUND_PER_PERIOD){v=f/100}else{v=(f/e)/100}}else{if(b==1){d=f/100}else{if(this.COMPOUND_PER_PERIOD){d=KJE.FV_AMT(f/100,b,1)}else{d=1/Math.pow((1+f/(b*100)),(-1*b))-1}}v=Math.pow(1+(d),1/e)-1}if(z){var j=this.sSchedule;j.clearRepeat();j.addHeader((this.bSHOW_BY_PERIOD?(j.sReportCol("x",1)==("x")?""+(this.sPeriodSelected2==("")?"":this.sPeriodSelected2.substring(0,1).toUpperCase()+this.sPeriodSelected2.substring(1,this.sPeriodSelected2.length))+"":"&nbsp;"):j.sReportCol("Year",1)),j.sReportCol("Additions",2),j.sReportCol("Interest",3),j.sReportCol("Balance",4));j.addRepeat((j.sReportCol("x",1)==("x")?"Start":"&nbsp;"),h.dollars(c,2),"&nbsp;",h.dollars(c,2))}var a=e*o+this.PERIODS;var k=e*g+this.PERIODS;var y=c;for(var t=0;t<a;t++){var q=(t<k?s:0);x+=q;if(this.PAYMENTS_AT_START){y+=q;r=h.round(v*y,2);w+=r;y+=r}else{r=h.round(v*y,2);w+=r;y+=q;y+=r}if(z&&this.bSHOW_BY_PERIOD){j.addRepeat(h.input(t+1),h.dollars(q,2),h.dollars(r,2),h.dollars(y,2))}if(((t+1)%e)==0){this.DR_BALANCE[l]=y;this.DR_INTEREST[l]=w;this.DR_ADDITIONS[l]=x;w=0;x=0;l++}}if((this.DR_INTEREST.length>l)){this.DR_BALANCE[l]=y;this.DR_INTEREST[l]=w;this.DR_ADDITIONS[l]=x}var u=0;this.DS_INTEREST=KJE.FloatArray(m);this.cats=new Array(m);for(t=1;t<=m;t++){u=t-1;this.cats[u]=""+t;if(u>0){this.DS_INTEREST[u]=this.DR_INTEREST[u]+this.DS_INTEREST[u-1]}else{this.DS_INTEREST[u]=this.DR_INTEREST[u]}if(z&&!this.bSHOW_BY_PERIOD){j.addRepeat(h.input(t),h.dollars(this.DR_ADDITIONS[u],2),h.dollars(this.DR_INTEREST[u],2),h.dollars(this.DR_BALANCE[u],2))}}this.TOTAL_AMOUNT_YOU_HAVE_PAID_IN=h.round(p,2);this.TOTAL_AT_END_OF_INVESTMENT=h.round(y,2);this.YEARS=g;this.YEARS_TO_PROJECT=o};KJE.CompoundSavingsCalc.prototype.formatReport=function(b){var c=KJE;var a=this.iDecimal;var d=b;d=KJE.replace("DEPOSIT_TYPE",(this.PAYMENTS_AT_START?"at the start of each period":"at the end of each period"),d);d=KJE.replace("STARTING_AMOUNT",c.dollars(this.STARTING_AMOUNT,2),d);d=KJE.replace("ADDITIONAL_CONTRIBUTIONS",c.dollars(this.ADDITIONAL_CONTRIBUTIONS,2),d);d=KJE.replace("DEPOSIT_FREQUENCY",this.FREQ_DESC,d);d=KJE.replace("FMT_PERIODS",this.sFmtYears,d);d=KJE.replace("YEARS_TO_PROJECT",this.YEARS_TO_PROJECT,d);d=KJE.replace("YEARS",this.MSG_PERIOD_YEARS,d);d=KJE.replace("RATE_OF_RETURN",c.percent(this.RATE_OF_RETURN/100,2),d);d=KJE.replace("COMPOUND_INTEREST",KJE.replace("compound","compounded",this.COMPOUND_DESC),d);d=KJE.replace("TOTAL_AMOUNT_YOU_HAVE_PAID_IN",c.dollars(this.TOTAL_AMOUNT_YOU_HAVE_PAID_IN,2),d);d=KJE.replace("TOTAL_AT_END_OF_INVESTMENT",c.dollars(this.TOTAL_AT_END_OF_INVESTMENT,2),d);d=KJE.replace("TOTAL_INTEREST_AT_END_OF_INVESTMENT",c.dollars(this.TOTAL_AT_END_OF_INVESTMENT-this.TOTAL_AMOUNT_YOU_HAVE_PAID_IN,2),d);d=d.replace("**REPEATING GROUP**",this.sSchedule.getRepeat());this.sSchedule.clearRepeat();return d};KJE.CompoundSavingsCalc.DEPOSIT_ANNUAL=4;KJE.CompoundSavingsCalc.DEPOSIT_MONTHLY=2;KJE.CompoundSavingsCalc.COMPOUND_ANNUAL=3;KJE.CompoundSavingsCalc.COMPOUND_MONTHLY=1;KJE.CompoundSavingsCalc.DEPOSIT_SELECTIONS=KJE.parameters.get("ARRAY_DEPOSIT_SELECTIONS",["per week","bi-weekly","per month","per quarter","per year"]);KJE.CompoundSavingsCalc.DEPOSIT_PERIODS=KJE.parameters.get("ARRAY_DEPOSIT_PERIODS",["Weeks","Bi-weeks","Months","Quarters",""]);KJE.CompoundSavingsCalc.DEPOSIT_VALUE=KJE.parameters.get("ARRAY_DEPOSIT_VALUE",[52,26,12,4,1]);KJE.CompoundSavingsCalc.DEPOSIT_INDEX=KJE.parameters.get("ARRAY_DEPOSIT_INDEX",[0,1,2,3,4]);KJE.CompoundSavingsCalc.COMPOUND_SELECTIONS=KJE.parameters.get("ARRAY_COMPOUND_SELECTIONS",["compound daily","compound monthly","compound quarterly","compound annually"]);KJE.CompoundSavingsCalc.COMPOUND_VALUE=KJE.parameters.get("ARRAY_COMPOUND_VALUE",[365,12,4,1]);KJE.CompoundSavingsCalc.COMPOUND_INDEX=KJE.parameters.get("ARRAY_COMPOUND_INDEX",[0,1,2,3]);KJE.CalcName="Reverse Mortgage Calculator";KJE.CalcType="ReverseMortgage";KJE.CalculatorTitleTemplate="Your estimated total is KJE1 after KJE2.";KJE.parseInputs=function(a){var c=KJE.getDropBox("COMPOUND_INTEREST",KJE.CompoundSavingsCalc.COMPOUND_ANNUAL,KJE.CompoundSavingsCalc.COMPOUND_INDEX,KJE.CompoundSavingsCalc.COMPOUND_SELECTIONS);a=KJE.replace("**COMPOUND_INTEREST**",c,a);var b=KJE.getDropBox("DEPOSIT_FREQUENCY",KJE.parameters.get("DEPOSIT_FREQUENCY",KJE.CompoundSavingsCalc.DEPOSIT_MONTHLY),KJE.CompoundSavingsCalc.DEPOSIT_INDEX,KJE.CompoundSavingsCalc.DEPOSIT_SELECTIONS);a=KJE.replace("**DEPOSIT_FREQUENCY**",b,a);return a};KJE.initialize=function(){KJE.CalcControl=new KJE.CompoundSavingsCalc();KJE.GuiControl=new KJE.CompoundSavings(KJE.CalcControl)};KJE.CompoundSavings=function(i){var e=KJE;var b=KJE.gLegend;var f=KJE.inputs.items;KJE.SliderKnobExtraClass=(KJE.DropperColors?KJE.DropperColors[0]:false);KJE.DollarSlider("STARTING_AMOUNT","Starting amount",0,10000000,0,0,2);KJE.DollarSlider("ADDITIONAL_CONTRIBUTIONS","Additional contributions",0,10000000,0,0,1);KJE.NumberSlider("YEARS","Years to save",KJE.parameters.get("YEARS_MINIMUM",0),100,0);KJE.NumberSlider("YEARS_TO_PROJECT","Years to compound interest",KJE.parameters.get("YEARS_MINIMUM",0),100,0);var j=100;if(KJE.parameters.get("DEPOSIT_FREQUENCY_HIDE",false)==true&&KJE.parameters.get("DEPOSIT_FREQUENCY",KJE.CompoundSavingsCalc.DEPOSIT_MONTHLY)==KJE.CompoundSavingsCalc.DEPOSIT_MONTHLY){j=12}KJE.NumberSlider("PERIODS","Periods",0,j,0);KJE.InvestRateSlider("RATE_OF_RETURN","Rate of return");KJE.DropBox("COMPOUND_INTEREST","Interest");KJE.DropBox("DEPOSIT_FREQUENCY","Frequency");KJE.Checkbox("PAYMENTS_AT_START","Payments at start of period",true,"");this.GRAPH_LABEL_2=KJE.parameters.get("MSG_GRAPH_LABEL_2","balance year");var g=KJE.gNewGraph(KJE.gCOLUMN,"GRAPH1",true,false,KJE.colorList[1],KJE.parameters.get("MSG_GRAPH_LABEL_1","Balance by Year"));g._legend.setVisible(false);g._legend._iOrientation=(b.TOP_RIGHT);var a=KJE.parameters.get("MSG_DROPPER_TITLE","Savings inputs: ");var c=KJE.parameters.get("MSG_DROPPER_CLOSETITLE","KJE1 with an additional KJE2 KJE3 at KJE4");var h=KJE.parameters.get("SHOW_DROPPER_TOTAL",false);if(h){var d=function(){return a+"|"+KJE.subText(e.dollars(i.TOTAL_AT_END_OF_INVESTMENT),"KJERightBold",KJE.subTextDropperContainer)}}else{var d=function(){return a+KJE.subText(KJE.getKJEReplaced(c,e.dollars(i.STARTING_AMOUNT),e.dollars(i.ADDITIONAL_CONTRIBUTIONS),i.FREQ_DESC,e.percent(i.RATE_OF_RETURN/100,3)),"KJECenter")}}KJE.addDropper(new KJE.Dropper("INPUTS",true,(h?d:a),d),KJE.colorList[0])};KJE.CompoundSavings.prototype.setValues=function(b){var a=KJE.inputs.items;b.PAYMENTS_AT_START=a.PAYMENTS_AT_START.getValue();b.DEPOSIT_FREQUENCY_INDEX=a.DEPOSIT_FREQUENCY.getValue();if(b.DEPOSIT_FREQUENCY!=KJE.CompoundSavingsCalc.DEPOSIT_ANNUAL){a.PERIODS.enable()}else{a.PERIODS.disable();a.PERIODS.setValue(0,true);b.PERIODS=0}b.COMPOUND_INTEREST_INDEX=a.COMPOUND_INTEREST.getValue();b.ADDITIONAL_CONTRIBUTIONS=a.ADDITIONAL_CONTRIBUTIONS.getValue();b.RATE_OF_RETURN=a.RATE_OF_RETURN.getValue();b.STARTING_AMOUNT=a.STARTING_AMOUNT.getValue();b.YEARS=a.YEARS.getValue();b.YEARS_TO_PROJECT=a.YEARS_TO_PROJECT.getValue();b.PERIODS=a.PERIODS.getValue()};KJE.CompoundSavings.prototype.refresh=function(e){var d=KJE;var c=KJE.gLegend;var b=KJE.inputs.items;var a=KJE.gGraphs[0];KJE.setTitleTemplate(d.dollars(e.TOTAL_AT_END_OF_INVESTMENT),e.sFmtYears.trim());e.bSHOW_BY_PERIOD=false;a.removeAll();a.setGraphCategories(e.cats);a._showItemLabel=!(e.DR_BALANCE.length>6);a._showItemLabelOnTop=true;a.add(new KJE.gGraphDataSeries(e.DR_BALANCE,this.GRAPH_LABEL_2,a.getColor(1)));a.paint();b.YEARS.setValue(e.YEARS,true);b.YEARS_TO_PROJECT.setValue(e.YEARS_TO_PROJECT,true);b.PERIODS.setValue(e.PERIODS,true);KJE.setLabelText(b.PERIODS._label,KJE.CompoundSavingsCalc.DEPOSIT_PERIODS[e.DEPOSIT_FREQUENCY_INDEX]+KJE.Colon)};KJE.InputScreenText=" <div id=KJE-D-INPUTS><div id=KJE-P-INPUTS>Input information:</div></div> <div id=KJE-E-INPUTS > <div id='KJE-C-STARTING_AMOUNT'><input id='KJE-STARTING_AMOUNT' /></div> <div id='KJE-C-YEARS'><input id='KJE-YEARS' /></div> <div id='KJE-C-PERIODS'><input id='KJE-PERIODS' /></div> <div id='KJE-C-ADDITIONAL_CONTRIBUTIONS'><input id='KJE-ADDITIONAL_CONTRIBUTIONS' /></div> <div id='KJE-C-RATE_OF_RETURN'><input id='KJE-RATE_OF_RETURN' /></div> <div id='KJE-C-DEPOSIT_FREQUENCY'>**DEPOSIT_FREQUENCY**</div> <div id='KJE-C-COMPOUND_INTEREST'>**COMPOUND_INTEREST**</div> <div style=\"height:10px\"></div> </div> **GRAPH1** ";KJE.DefinitionText=" <div id='KJE-D-STARTING_AMOUNT' ><dt>Lump sum advance</dt><dd>The starting balance or amount you expect to receive immediately from your reverse mortgage.</dd></div> <div id='KJE-D-YEARS' ><dt>Years</dt><dd>The total number of years you are planning draw from the reverse mortgage.</dd></div> <div id='KJE-D-ADDITIONAL_CONTRIBUTIONS' ><dt>Monthly loan advance</dt><dd>Total monthly amount you plan on receiving, in addition to the lump sum advance.</dd></div> <div id='KJE-D-RATE_OF_RETURN' ><dt>Interest rate</dt><dd>The annual interest rate for this loan.</dd></div> ";KJE.ReportText=' <!--HEADING "Reverse Mortgage Calculator" HEADING--> <h2 class=\'KJEReportHeader KJEFontHeading\'>Your reverse mortgage balance could be TOTAL_AT_END_OF_INVESTMENT after YEARS years. </h2> This includes an initial lump sum advance of STARTING_AMOUNT, additional advances of ADDITIONAL_CONTRIBUTIONS DEPOSIT_FREQUENCY and an interest rate of RATE_OF_RETURN. **GRAPH**<div class=KJEReportTableDiv><table class=KJEReportTable><caption class=\'KJEHeaderRow KJEHeading\'>Results Summary</caption> <tr class=KJEOddRow><td class="KJELabel KJECellBorder KJECell60">Lump sum advance </td><td class="KJECell KJECell40"> STARTING_AMOUNT </td></tr> <tr class=KJEEvenRow><td class="KJELabel KJECellBorder">Years </td><td class="KJECell">YEARS </td></tr> <tr class=KJEOddRow><td class="KJELabel KJECellBorder">Monthly loan advance </td><td class="KJECell"> ADDITIONAL_CONTRIBUTIONS DEPOSIT_FREQUENCY </td></tr> <tr class=KJEEvenRow><td class="KJELabel KJECellBorder">Interest rate </td><td class="KJECell"> RATE_OF_RETURN</td></tr> <tr class=KJEOddRow><td class="KJELabel KJECellBorder">Total payments you will have received </td><td class="KJECell"> TOTAL_AMOUNT_YOU_HAVE_PAID_IN </td></tr> <tr class=KJEEvenRow><td class="KJELabel KJECellBorder">Total interest accumulated </td><td class="KJECell"> TOTAL_INTEREST_AT_END_OF_INVESTMENT </td></tr> <tr class=KJEOddRow><td class="KJELabel KJECellBorder">Ending mortgage balance </td><td class="KJECell">TOTAL_AT_END_OF_INVESTMENT</td></tr></table> </div> <h2 class=\'KJEScheduleHeader KJEFontHeading\'>Mortgage Balance by Year</h2> **REPEATING GROUP** ';